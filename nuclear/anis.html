<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Monte Carlo Renderer</title>
  <script src="pixi.min.js"></script>
</head>
<body>
  <script type="text/javascript">
    const type = PIXI.utils.isWebGLSupported() ? 'WebGL' : 'canvas';
    PIXI.utils.sayHello(type);

    const app = new PIXI.Application({
        width: 512,
        height: 512,
        antialias: false,
        transparent: false,
        resolution: 1,
    });

    const game = {
      _lastTime: Date.now(),
      components: [],
    };

    app.ticker.add(delta => gameLoop(game, delta));
    const canvas = new PIXI.Graphics();
    app.stage.addChild(canvas);
    document.body.appendChild(app.view);
    game.canvas = canvas;

    const Point = class {
      constructor(x, y) {
        this.x = x;
        this.y = y;
      }

      times(m) {
        return new Point(this.x * m, this.y * m);
      }

      add(p) {
        return new Point(this.x + p.x, this.y + p.y);
      }
    };

    const Particle = class {
      constructor(p, speed) {
        this.p = p;
        this.speed = speed;
      }

      update(dt) {
        this.p = this.p.add(this.speed.times(dt));
      }

      render(canvas) {
        canvas.lineStyle(2, 0x854442);
        canvas.drawCircle(this.p.x, this.p.y, 1);
      }
    };

    const gameLoop = (game, delta) => {
      const time = Date.now();
      const dt = time - game._lastTime;
      game._lastTime = time;
      update(game, dt / 1000);
      render(game);
    };

    const render = game => {
      const { canvas } = game;
      canvas.beginFill(0x3C2F2F);
      canvas.drawRect(0, 0, 512, 512);
      canvas.endFill();

      game.components.forEach(p => p.render(canvas));
    };

    const update = (game, dt) => {
      game.components.forEach(p => p.update(dt));
    };

    game.components.push(new Particle(new Point(10, 512/2), new Point(20, 0)));
    game.components.push(new Particle(new Point(512 - 10, 512/2), new Point(-20, 0)));
  </script>
</body>
</html>
